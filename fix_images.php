<?php
// fix_images.php
echo "<h3>ЁЯФз р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Бр╕ер╕░р╣Бр╕Бр╣Йр╣Др╕Вр╕Ыр╕▒р╕Нр╕лр╕▓р╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣М images</h3>";

$folder_path = "images";

// 1. р╕кр╕гр╣Йр╕▓р╕Зр╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣Мр╕Цр╣Йр╕▓р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡
if (!file_exists($folder_path)) {
    if (mkdir($folder_path, 0755, true)) {
        echo "тЬЕ р╕кр╕гр╣Йр╕▓р╕Зр╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣М images р╕кр╕│р╣Ар╕гр╣Зр╕И!<br>";
    } else {
        echo "тЭМ р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╕кр╕гр╣Йр╕▓р╕Зр╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣М images р╣Др╕Фр╣Й<br>";
        exit;
    }
} else {
    echo "тЬЕ р╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣М images р╕бр╕╡р╕нр╕вр╕╣р╣Ир╣Бр╕ер╣Йр╕з<br>";
}

// 2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕кр╕┤р╕Чр╕Шр╕┤р╣Мр╕Бр╕▓р╕гр╣Ар╕Вр╕╡р╕вр╕Щ
if (is_writable($folder_path)) {
    echo "тЬЕ р╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣М images р╕бр╕╡р╕кр╕┤р╕Чр╕Шр╕┤р╣Мр╣Ар╕Вр╕╡р╕вр╕Щ<br>";
} else {
    echo "тЭМ р╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣М images р╣Др╕бр╣Ир╕бр╕╡р╕кр╕┤р╕Чр╕Шр╕┤р╣Мр╣Ар╕Вр╕╡р╕вр╕Щ<br>";
    
    // р╕Юр╕вр╕▓р╕вр╕▓р╕бр╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕кр╕┤р╕Чр╕Шр╕┤р╣М
    if (chmod($folder_path, 0755)) {
        echo "тЬЕ р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕кр╕┤р╕Чр╕Шр╕┤р╣Мр╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣Мр╣Ар╕Ыр╣Зр╕Щ 755 р╕кр╕│р╣Ар╕гр╣Зр╕И<br>";
    } else {
        echo "тЭМ р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕кр╕┤р╕Чр╕Шр╕┤р╣Мр╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣Мр╣Др╕Фр╣Й<br>";
    }
}

// 3. р╕кр╕гр╣Йр╕▓р╕Зр╣Др╕Яр╕ер╣Мр╕Чр╕Фр╕кр╕нр╕Ъ
$test_file = $folder_path . "/test.txt";
if (file_put_contents($test_file, "Test file created at " . date('Y-m-d H:i:s'))) {
    echo "тЬЕ р╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕Вр╕╡р╕вр╕Щр╣Др╕Яр╕ер╣Мр╣Гр╕Щр╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣М images р╣Др╕Фр╣Й<br>";
    unlink($test_file); // р╕ер╕Ър╣Др╕Яр╕ер╣Мр╕Чр╕Фр╕кр╕нр╕Ъ
} else {
    echo "тЭМ р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕Вр╕╡р╕вр╕Щр╣Др╕Яр╕ер╣Мр╣Гр╕Щр╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣М images р╣Др╕Фр╣Й<br>";
}

// 4. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ path р╕Чр╕╡р╣Ир╣Бр╕Чр╣Йр╕Ир╕гр╕┤р╕З
echo "ЁЯУН Path р╕Ир╕гр╕┤р╕З: " . realpath($folder_path) . "<br>";
echo "ЁЯУН Working Directory: " . getcwd() . "<br>";

// 5. р╕кр╕гр╣Йр╕▓р╕Зр╣Др╕Яр╕ер╣М default.jpg р╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕┤р╕Щр╕Др╣Йр╕▓р╕Чр╕╡р╣Ир╣Др╕бр╣Ир╕бр╕╡р╕гр╕╣р╕Ы
$default_image = $folder_path . "/default.jpg";
if (!file_exists($default_image)) {
    // р╕кр╕гр╣Йр╕▓р╕Зр╕гр╕╣р╕Ыр╕ар╕▓р╕Ю default р╕Зр╣Ир╕▓р╕вр╣Ж р╕Фр╣Йр╕зр╕в GD
    if (function_exists('imagecreate')) {
        $im = imagecreate(100, 100);
        $bg = imagecolorallocate($im, 240, 240, 240);
        $text_color = imagecolorallocate($im, 150, 150, 150);
        imagestring($im, 2, 10, 45, "No Image", $text_color);
        imagejpeg($im, $default_image, 80);
        imagedestroy($im);
        echo "тЬЕ р╕кр╕гр╣Йр╕▓р╕Зр╣Др╕Яр╕ер╣М default.jpg р╕кр╕│р╣Ар╕гр╣Зр╕И<br>";
    } else {
        echo "тЪая╕П р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╕кр╕гр╣Йр╕▓р╕З default.jpg (GD not available)<br>";
    }
} else {
    echo "тЬЕ р╣Др╕Яр╕ер╣М default.jpg р╕бр╕╡р╕нр╕вр╕╣р╣Ир╣Бр╕ер╣Йр╕з<br>";
}

echo "<hr><h4>ЁЯОп р╕кр╕гр╕╕р╕Ыр╕кр╕Цр╕▓р╕Щр╕░:</h4>";
echo "р╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣М images р╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╣Бр╕ер╣Йр╕з!";
?>